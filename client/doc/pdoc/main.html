<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>main API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>main</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import logging
import logging.config
import argparse
from os.path import exists
from threading import Thread
from tendo import singleton
from sys import exit

from config_manager import Config
from usb_detector.detector import register_listener, usb_detector_run, usb_detector_set_config
from usb_detector.event_listener import usb_connected_callback, usb_disconnected_callback
from usb_detector.api_client import api_client_run, api_client_set_config


def init_logging(app_config: Config):
    &#34;&#34;&#34;Initializes logging, api client, and usb detector.

    The function checks whether the path to the logger configuration
    file is valid or not. The path is defined in the logger section of the
    main configuration file. It also calls api_client_set_config and
    usb_detector_set_config to fully initialize the application.

    :param app_config: instance of Config (config manager)
    &#34;&#34;&#34;
    # If the logger configuration file exists.
    if exists(app_config.logger_config_file):
        # Initialize logging according to the logger config file.
        logging.config.fileConfig(fname=app_config.logger_config_file)

        # Initialize the rest of the application.
        api_client_set_config(app_config)
        usb_detector_set_config(app_config)
    else:
        # If the file does not exist, terminate the application.
        print(f&#34;Cannot find logger configuration \&#34;{app_config.logger_config_file}\&#34;! Please specify valid a path or define a new one.&#34;)
        exit(1)


if __name__ == &#34;__main__&#34;:
    &#34;&#34;&#34;Main entry point of the application.
    
    The application expects one parameter to be passed in -
    the path to the configuration file. The user can print out help
    using the &#39;-h&#39; option.
    &#34;&#34;&#34;
    # Make sure that there is only one running instance (process) of this application.
    try:
        app_instance = singleton.SingleInstance()
    except singleton.SingleInstanceException:
        exit(1)

    # Parse the arguments passed in from the command line.
    arg_parser = argparse.ArgumentParser(description=&#34;ZF USB License Detector&#34;)
    arg_parser.add_argument(&#34;-c&#34;, &#34;--config&#34;, dest=&#34;config&#34;, required=True, help=&#34;Path to the configuration file&#34;)
    args = arg_parser.parse_args()

    # Read the configuration file and initialize the application (logging).
    config = Config(args.config)
    init_logging(config)

    # Register callbacks (connected/disconnected USB device).
    register_listener(callback=usb_connected_callback, connected=True)
    register_listener(callback=usb_disconnected_callback, connected=False)

    # Create a thread for the USB detector.
    usb_detector_thread = Thread(target=usb_detector_run)
    usb_detector_thread.setDaemon(True)

    # Create a thread for resending failed payloads to the server.
    api_thread = Thread(target=api_client_run)
    api_thread.setDaemon(True)

    # Start the USB detector thread.
    logging.info(&#34;Starting USB detector.&#34;)
    usb_detector_thread.start()

    # Start the API client thread.
    logging.info(&#34;Starting API communication manager.&#34;)
    api_thread.start()

    # The execution should never get here as both
    # threads are infinite loops.
    usb_detector_thread.join()
    api_thread.join()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="main.init_logging"><code class="name flex">
<span>def <span class="ident">init_logging</span></span>(<span>app_config:Â <a title="config_manager.Config" href="config_manager.html#config_manager.Config">Config</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Initializes logging, api client, and usb detector.</p>
<p>The function checks whether the path to the logger configuration
file is valid or not. The path is defined in the logger section of the
main configuration file. It also calls api_client_set_config and
usb_detector_set_config to fully initialize the application.</p>
<p>:param app_config: instance of Config (config manager)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_logging(app_config: Config):
    &#34;&#34;&#34;Initializes logging, api client, and usb detector.

    The function checks whether the path to the logger configuration
    file is valid or not. The path is defined in the logger section of the
    main configuration file. It also calls api_client_set_config and
    usb_detector_set_config to fully initialize the application.

    :param app_config: instance of Config (config manager)
    &#34;&#34;&#34;
    # If the logger configuration file exists.
    if exists(app_config.logger_config_file):
        # Initialize logging according to the logger config file.
        logging.config.fileConfig(fname=app_config.logger_config_file)

        # Initialize the rest of the application.
        api_client_set_config(app_config)
        usb_detector_set_config(app_config)
    else:
        # If the file does not exist, terminate the application.
        print(f&#34;Cannot find logger configuration \&#34;{app_config.logger_config_file}\&#34;! Please specify valid a path or define a new one.&#34;)
        exit(1)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="main.init_logging" href="#main.init_logging">init_logging</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>